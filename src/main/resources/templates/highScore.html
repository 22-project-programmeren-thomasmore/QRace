<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <!--meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- stylesheet -->
    <link rel="stylesheet" type="text/css" href="/css/stylesheet.css"/>
    <!-- bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- javascript -->
    <script src="/js/translator.js"></script>
    <script src="/js/translations.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- title -->
    <title>Highscores</title>
</head>

<body>
<!-- navbar -->
<nav class="navbar navbar-expand-xxl navbar-light bg-light">
    <a class="navbar-brand" href="https://www.speelgoedmuseum.be/"><img src="/img/logo.png" height="50"
                                                                        class="d-inline-block align-top"
                                                                        alt="Speelgoedmuseum Mechelen"></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown"
            aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation"><span
            class="navbar-toggler-icon"></span></button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav text-right">
            <li id="home" class="nav-item active"><a class="nav-link" href="#"><span
                    class="sr-only">(current)</span></a></li>
            <li id="inlog" class="nav-item"><a class="nav-link" href="#"></a></li>
            <li id="info" class="nav-item"><a class="nav-link" href="#"></a></li>
            <li id="changeLanguage" class="nav-item"><img src="/img/translate.svg" alt="Translate"></li>
        </ul>
    </div>
</nav>


<form th:action="@{/highscore}" th:object="${highscore}" method="post">
    <label for="userName">User Name:</label><br>
    <input type="text" id="userName" th:field="*{userName}" name="userName" required><br>

    <label for="score">Score:</label><br>
    <input type="number" id="score" th:field="*{score}" name="score" required><br>

    <label for="highscoreDate">Highscore Date:</label><br>
    <input type="date" id="highscoreDate" th:field="*{highscoreDate}" name="highscoreDate" required><br>

    <input type="submit" value="Submit">
</form>

<select id="sort-select">
    <option value="">Default (Date)</option>
    <option value="Highscore">Highscore</option>
    <option value="Username">Username</option>
</select>

<table>
    <tr>
        <th>Id</th>
        <th>User Name</th>
        <th>Score</th>
        <th>Highscore Date</th>
        <th>Actions</th>
    </tr>
    <tr th:each="score : ${highscores}">
        <td>
            <span class="form-control-id" data-field="id" th:text="${score.id}"></span>
<!--            <input type="text" class="form-control-id" style="display: none;">-->
        </td>
        <td>
            <span class="editable" data-field="userName" th:text="${score.userName}"></span>
            <input type="text" class="form-control-user-name" style="display: none;">
        </td>
        <td>
            <span class="editable" data-field="score" data-id="${score.id}" th:text="${score.score}"></span>
            <input type="number" class="form-control-score" style="display: none;">
        </td>
        <td>
        <span class="editable" data-field="highscoreDate" data-id="${score.id}"
              th:text="${#dates.format(score.highscoreDate, 'yyyy-MM-dd')}"></span>
            <input type="date" class="form-control-highscore" style="display: none;">
        </td>


        <td>
            <button class="btn btn-primary edit-button">Edit</button>
            <button class="btn btn-success save-button" style="display: none;">Save</button>
            <button class="btn btn-danger cancel-button" style="display: none;">Cancel</button>
            <button class="btn btn-danger delete-button" th:data-id="${score.id}" onclick="deleteHighscore(this)">Delete</button>


        </td>
    </tr>
</table>
<script th:inline="javascript">
    $(document).ready(function () {
        $(".edit-button").click(function () {
            var row = $(this).closest("tr");
            row.find(".editable").hide();
            row.find("input").show();
            row.find(".edit-button").hide();
            row.find(".save-button, .cancel-button").show();
        });

        $(".cancel-button").click(function () {
            var row = $(this).closest("tr");
            row.find("input").hide();
            row.find(".editable").show();
            row.find(".edit-button").show();
            row.find(".save-button, .cancel-button").hide();
        });

        $(".save-button").click(function () {
            var row = $(this).closest("tr");

            var id = row.find(".form-control-id[data-field='id']").text();

            var userNameInput = row.find('.form-control-user-name'); // Find the input field for userName
            var userName = userNameInput.val(); // Get the value of the input field

            var scoreInput = row.find('.form-control-score'); // Find the input field for score
            var score = scoreInput.val(); // Get the value of the input field

            var dateInput = row.find('.form-control-highscore'); // Find the input field for highscoreDate
            var highscoreDate = dateInput.val(); // Get the value of the input field



            var updatedData = {
                id: id, // will stay the same
                userName: userName,
                score: score,
                highscoreDate: highscoreDate
            };
            console.log(updatedData);

            $.ajax({
                url: "/updateHighscore",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify(updatedData),
                success: function () {
                    // Update the row with the new values
                    row.find(".editable[data-field='userName']").text(userName);
                    row.find(".editable[data-field='score']").text(score);
                    row.find(".editable[data-field='highscoreDate']").text(highscoreDate);

                    // Show the editable fields and hide the input fields and buttons
                    row.find("input").hide();
                    row.find(".editable").show();
                    row.find(".edit-button").show();
                    row.find(".save-button, .cancel-button").hide();
                },
                error: function () {
                    alert("Failed to update the highscore.");
                }
            });
        });

    });
    function deleteHighscore(button) {
        var id = $(button).data("id");
        var row = $(button).closest("tr");

        $.ajax({
            url: "/highscores/" + id,
            type: "DELETE",
            success: function () {
                // Remove the row from the table
                row.remove();
                alert("Highscore deleted successfully.");
            },
            error: function () {
                alert("Failed to delete the highscore.");
            }
        });
    }



</script>


</body>
</html>